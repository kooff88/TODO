## Redis

Redis 是一种键值数据库( Key - Value )。 相对于关系型数据 例如 Mysql， Redis 是 非关系型数据库。

MySQL 这样的关系型数据库，表的结构比较复杂，会包含很多字段，可以通过 SQL 语句，来实现非常复杂的查询需求。  
而 Redis 中只包含“键”和“值”两部分，只能通过“键”来查询“值”。正是因为这样简单的存储结构，也让 Redis 的读写效率非常高

Redis 主要是作为内存数据库，也支持将数据存储在硬盘中。

值的数据类型有很多，字符串、列表、字典、集合、有序集合。

### 列表（list）

数据类型对应两种实现方法，一种是压缩列表（ziplist），另一种是双向循环链表。

压缩列表：是 Redis 自己设计的一种数据存储结构。

```
列表中保存的单个数据（有可能是字符串类型的）小于 64 字节；
列表中数据个数少于 512 个。
```

Redis 的这种双向链表的实现方式，非常值得借鉴。它额外定义一个 list 结构体，  
来组织链表的首、尾指针，还有长度等信息。这样，在使用的时候就会非常方便。

```c

// 以下是C语言代码，因为Redis是用C语言实现的。
typedef struct listnode {
  struct listNode *prev;
  struct listNode *next;
  void *value;
} listNode;


typedef struct list {
  listNode *head;
  listNode *tail;
  unsigned long len;
  // ....省略其他定义
} list;
```

### 字典（hash）

字典类型也有两种实现方式。一种是我们刚刚讲到的压缩列表，另一种是散列表。

当数据动态增加之后，散列表的装载因子会不停地变大。为了避免散列表性能的下降，当装载因子大于 1 的时候，  
Redis 会触发扩容，将散列表扩大为原来大小的 2 倍左右

当数据动态减少之后，为了节省内存，当装载因子小于 0.1 的时候，Redis 就会触发缩容，缩小为字典中数据个数的大约 2 倍大小）。

### 集合（set）

一种是基于有序数组，另一种是基于散列表

有序数组:

```
存储的数据都是整数；
存储的数据元素个数不超过 512 个。
```

### 有序集合（sortedset）

跳表 储一组数据，并且每个数据会附带一个得分

使用压缩列表来实现有序集合的前提，有这样两个：

```
所有数据的大小都要小于 64 字节；
元素个数要小于 128 个。
```

### 数据结构持久化

支持数据落盘，支持数据落盘。  
机器断电的时候，存储在 Redis 中的数据也不会丢失

第一种是清除原有的存储结构，只将数据存储到磁盘中。当我们需要从磁盘还原数据到内存的时候，  
再重新将数据组织成原来的数据结构。实际上，Redis 采用的就是这种持久化思路。

第二种方式是保留原来的存储格式，将数据按照原有的格式存储在磁盘中。  
可以将散列表的大小、每个数据被散列到的槽的编号等信息，都保存在磁盘中。  
有了这些信息，我们从磁盘中将数据还原到内存中的时候，就可以避免重新计算哈希值。
